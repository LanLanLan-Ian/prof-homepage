<script>
document.addEventListener('DOMContentLoaded', function() {
  // 只在 publication 页面执行
  if (!window.location.pathname.includes('/publication')) return;
  
  console.log('Filter script loaded');
  
  // Collect all unique categories
  const cards = document.querySelectorAll('.publication-card');
  const categories = new Set();
  
  cards.forEach(card => {
    const cardCategories = card.dataset.categories;
    console.log('Card categories:', cardCategories);
    if (cardCategories && cardCategories.trim()) {
      cardCategories.split(',').forEach(cat => {
        const trimmedCat = cat.trim();
        if (trimmedCat) {
          categories.add(trimmedCat);
          console.log('Added category:', trimmedCat);
        }
      });
    }
  });
  
  console.log('All categories found:', Array.from(categories));
  
  // Populate dropdown options
  const select = document.getElementById('category-filter');
  if (select) {
    categories.forEach(category => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = category;
      select.appendChild(option);
    });
  }
  
  // Add change event listener
  if (select) {
    select.addEventListener('change', function() {
      const selectedCategory = this.value;
      console.log('Selected category:', selectedCategory);
      
      // Filter cards
      cards.forEach(card => {
        const cardCategories = card.dataset.categories;
        if (selectedCategory === 'all' || (cardCategories && cardCategories.includes(selectedCategory))) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    });
  }
});
</script>