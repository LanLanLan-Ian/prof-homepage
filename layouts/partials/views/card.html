<!-- Enhanced publication view with dropdown filter (no category tags shown) -->

<!-- Dropdown filter (only show once at the top) -->
{{ if eq .index 0 }}
<div class="mb-8">
  <div class="flex items-center gap-3">
    <label for="category-filter" class="text-gray-700 dark:text-gray-300 font-medium">Filter:</label>
    <select id="category-filter" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none min-w-[160px]">
      <option value="all">All</option>
      <!-- Dynamic options will be populated by JavaScript -->
    </select>
  </div>
</div>
{{ end }}

{{ $item := .item }}

{{ $link := "" }}
{{ $target := "" }}
{{ if $item.Params.url_pdf }}
  {{ $link = $item.Params.url_pdf }}
  {{ $target = "target=\"_blank\" rel=\"noopener\"" }}
{{ else }}
  {{ $link = $item.RelPermalink }}
{{ end }}

{{ $resource := partial "functions/get_featured_image.html" $item }}
{{ $anchor := $item.Params.image.focal_point | default "Center" }}

<!-- Publication card with categories data (categories hidden from display) -->
<div class="publication-card mb-6 bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow p-6"
     data-categories="{{ if $item.Params.categories }}{{ delimit $item.Params.categories "," }}{{ end }}">
  
  <div class="flex items-center gap-6">
    
    <!-- Left: Publication Image -->
    <div class="flex-shrink-0">
      {{ with $resource }}
        {{ $image := .Fit "400x200" }}
        {{ if ne $image.MediaType.SubType "gif" }}{{ $image = $image.Process "webp" }}{{ end }}
        <img class="w-[400px] h-[200px] object-cover rounded-lg" loading="lazy" src="{{ $image.RelPermalink }}" height="{{ $image.Height }}" width="{{ $image.Width }}" alt="{{ $item.Title | plainify }}">
      {{ else }}
        <!-- Placeholder if no image -->
        <div class="w-[400px] h-[200px] bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center">
          <svg class="w-12 h-12 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path>
          </svg>
        </div>
      {{ end }}
    </div>
    
    <!-- Right: Publication Details -->
    <div class="flex-grow min-w-0">
      
      <!-- Title with Link -->
      <h3 class="mb-3">
        <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 no-underline hover:underline font-semibold text-xl leading-tight">
          {{ $item.Title }}
        </a>
      </h3>
      
      <!-- Authors -->
      {{ if $item.Params.authors }}
      <div class="mb-2">
        <span class="text-gray-600 dark:text-gray-300 text-base">
          {{ range $i, $author := $item.Params.authors }}
            {{ if $i }}, {{ end }}{{ $author }}
          {{ end }}
        </span>
      </div>
      {{ end }}
      
      <!-- Publication Venue -->
      {{ if $item.Params.publication }}
      <div class="mb-3">
        <span class="font-semibold text-gray-900 dark:text-gray-100 text-lg">{{ $item.Params.publication }}</span>
      </div>
      {{ end }}
      
      <!-- Awards -->
      {{ if $item.Params.awards }}
      <div class="mb-3">
        {{ range $item.Params.awards }}
        <span class="inline-block bg-red-600 text-white px-3 py-1 text-sm rounded-full mr-2">{{ . }}</span>
        {{ end }}
      </div>
      {{ end }}
      
      <!-- Links -->
      <div class="flex flex-wrap gap-2">
        {{ if $item.Params.url_code }}
        <a href="{{ $item.Params.url_code }}" target="_blank" class="inline-block bg-transparent border-2 border-red-600 text-red-600 hover:bg-red-600 hover:text-white px-4 py-1.5 text-sm rounded-lg transition-colors font-medium">
          Code
        </a>
        {{ end }}
        
        {{ if $item.Params.url_pdf }}
        <a href="{{ $item.Params.url_pdf }}" target="_blank" class="inline-block bg-transparent border-2 border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white px-4 py-1.5 text-sm rounded-lg transition-colors font-medium">
          PDF
        </a>
        {{ end }}
        
        {{ if $item.Params.url_slides }}
        <a href="{{ $item.Params.url_slides }}" target="_blank" class="inline-block bg-transparent border-2 border-green-600 text-green-600 hover:bg-green-600 hover:text-white px-4 py-1.5 text-sm rounded-lg transition-colors font-medium">
          Slides
        </a>
        {{ end }}
        
        {{ if $item.Params.url_project }}
        <a href="{{ $item.Params.url_project }}" target="_blank" class="inline-block bg-transparent border-2 border-purple-600 text-purple-600 hover:bg-purple-600 hover:text-white px-4 py-1.5 text-sm rounded-lg transition-colors font-medium">
          Project
        </a>
        {{ end }}
      </div>
      
    </div>
  </div>
</div>


{{ if eq .index (sub (len .page.Pages) 1) }}
<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('Filter script loaded'); // Debug log
  
  // Collect all unique categories
  const cards = document.querySelectorAll('.publication-card');
  const categories = new Set();
  
  cards.forEach(card => {
    const cardCategories = card.dataset.categories;
    console.log('Card categories:', cardCategories); // Debug log
    if (cardCategories && cardCategories.trim()) {
      cardCategories.split(',').forEach(cat => {
        const trimmedCat = cat.trim();
        if (trimmedCat) {
          categories.add(trimmedCat);
          console.log('Added category:', trimmedCat); // Debug log
        }
      });
    }
  });
  
  console.log('All categories found:', Array.from(categories)); // Debug log
  
  // Populate dropdown options
  const select = document.getElementById('category-filter');
  categories.forEach(category => {
    const option = document.createElement('option');
    option.value = category;
    option.textContent = category;
    select.appendChild(option);
  });
  
  // Add change event listener
  select.addEventListener('change', function() {
    const selectedCategory = this.value;
    console.log('Selected category:', selectedCategory); // Debug log
    
    // Filter cards
    cards.forEach(card => {
      const cardCategories = card.dataset.categories;
      if (selectedCategory === 'all' || (cardCategories && cardCategories.includes(selectedCategory))) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  });
});
</script>
{{ end }}